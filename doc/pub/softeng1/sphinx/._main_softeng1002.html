

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basic implementations</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>

        <script src="http://sagecell.sagemath.org/static/jquery.min.js"></script>
        <script src="http://sagecell.sagemath.org/static/embedded_sagecell.js"></script>

        <script>sagecell.makeSagecell({inputLocation: ".sage"});</script>

        <style type="text/css">
                .sagecell .CodeMirror-scroll {
                        overflow-y: hidden;
                        overflow-x: auto;
                }
                .sagecell .CodeMirror {
                        height: auto;
                }
        </style>

    
    <link rel="top" title="Scientific software engineering; ODE model" href="index.html" />
    <link rel="next" title="User interfaces" href="._main_softeng1003.html" />
    <link rel="prev" title="&lt;no title&gt;" href="._main_softeng1001.html" />
 
  
       <style type="text/css">
         div.admonition {
           background-color: whiteSmoke;
           border: 1px solid #bababa;
         }
       </style>
      </head>
    
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="._main_softeng1003.html" title="User interfaces"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="._main_softeng1001.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Scientific software engineering; ODE model</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="basic-implementations">
<span id="softeng1-basic"></span><h1>Basic implementations<a class="headerlink" href="#basic-implementations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mathematical-problem-and-solution-technique">
<span id="softeng1-basic-math"></span><h2>Mathematical problem and solution technique<a class="headerlink" href="#mathematical-problem-and-solution-technique" title="Permalink to this headline">¶</a></h2>
<p>We address the perhaps simplest possible differential equation problem</p>
<div class="math" id="equation-softeng1:ode">
<span id="eq-softeng1-ode"></span><span class="eqno">(1)</span>\[     u'(t) = -au(t), \quad t \in (0,T],\]</div>
<div class="math" id="equation-softeng1:u0">
<span id="eq-softeng1-u0"></span><span class="eqno">(2)</span>\[     u(0)  = I,\]</div>
<p>where <span class="math">\(a\)</span>, <span class="math">\(I\)</span>, and <span class="math">\(T\)</span> are prescribed parameters, and <span class="math">\(u(t)\)</span> is
the unknown function to be estimated. This mathematical model
is relevant for physical phenomena featuring exponential decay
in time, e.g., vertical pressure variation in the atmosphere,
cooling of an object, and radioactive decay.</p>
<p>The
time domain is discretized with points <span class="math">\(0 = t_0 &lt; t_1 \cdots &lt; t_{N_t}=T\)</span>,
here with a constant spacing <span class="math">\(\Delta t\)</span> between the
mesh points: <span class="math">\(\Delta t = t_{n}-t_{n-1}\)</span>, <span class="math">\(n=1,\ldots,N_t\)</span>. Let
<span class="math">\(u^n\)</span> be the numerical approximation to the exact solution at <span class="math">\(t_n\)</span>.
A family of popular numerical methods can be written in the form</p>
<div class="math" id="equation-softeng1:utheta">
<span id="eq-softeng1-utheta"></span><span class="eqno">(3)</span>\[     u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,\]</div>
<p>for <span class="math">\(n=0,1,\ldots,N_t-1\)</span>. This numerical scheme corresponds to
the <a class="reference external" href="http://en.wikipedia.org/wiki/Forward_Euler_method">Forward Euler</a>
scheme when <span class="math">\(\theta=0\)</span>,
the <a class="reference external" href="http://en.wikipedia.org/wiki/Backward_Euler_method">Backward Euler</a>
scheme when <span class="math">\(\theta=1\)</span>,
and the <a class="reference external" href="http://en.wikipedia.org/wiki/Crank-Nicolson">Crank-Nicolson</a>
scheme when <span class="math">\(\theta=1/2\)</span>.
The initial condition <a href="#equation-softeng1:u0">(2)</a> is key to start
the recursion with a value for <span class="math">\(u^0\)</span>.</p>
</div>
<div class="section" id="a-first-quick-implementation">
<span id="softeng1-basic-impl1"></span><h2>A first, quick implementation<a class="headerlink" href="#a-first-quick-implementation" title="Permalink to this headline">¶</a></h2>
<p>Solving <a href="#equation-softeng1:utheta">(3)</a> in a program is very straightforward:
just make a loop over <span class="math">\(n\)</span> and evaluate the formula. The <span class="math">\(u(t_n\)</span>)
values for discrete <span class="math">\(n\)</span> can be stored in an array. This makes it easy
to also plot the solution. It would be natural to also add
the exact
solution curve <span class="math">\(u(t)=Ie^{-at}\)</span> to the plot.</p>
<p>We apply the Python programming language since it gives code close
to that of other popular languages such as MATLAB and R.
The programming habits of many students and engineers would lead them
to write a program like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">y_e</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This program is easy to read, and as long it is correct, many will
claim that it has sufficient quality. Nevertheless, the program suffers
from two serious flaws:</p>
<ol class="arabic simple">
<li>The notation in the program does not correspond <em>exactly</em> to
the notation in the mathematical problem: the solution is called
<code class="docutils literal"><span class="pre">y</span></code> and corresponds to <span class="math">\(u\)</span> in the mathematical description,
the variable <code class="docutils literal"><span class="pre">A</span></code> corresponds to the mathematical parameter <span class="math">\(I\)</span>,
<code class="docutils literal"><span class="pre">N</span></code> in the program is called <span class="math">\(N_t\)</span> in the mathematics.</li>
<li>There are no comments in the program.</li>
</ol>
<p>These kind of flaws quickly become crucial if present in code for complicated
mathematical problems and code that is meant to be extended to other problems.</p>
<p>We also note that the program is &#8220;flat&#8221; in the sense that it does
not contain functions. Usually, this is a bad habit, but let us
correct the two mentioned flaws first.</p>
</div>
<div class="section" id="a-more-decent-program">
<span id="softeng1-basic-impl2"></span><h2>A more decent program<a class="headerlink" href="#a-more-decent-program" title="Permalink to this headline">¶</a></h2>
<p>A code of better quality arises from
fixing the notation and adding comments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">I</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>     <span class="c"># no of time intervals</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c"># Backward Euler method</span>

<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
    <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="c"># Compute norm of the error</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>     <span class="c"># exact u at the mesh points</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>

<span class="c"># Compare numerical (u) and exact solution (u_e) in a plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>There is obviously not just one way to comment a program, and opinions
may differ as to what code should be accomplished by comments.
The guiding principle is, however, that comments should make the
program easy to understand for human eye. Do not comment obvious
constructions, but focus on ideas and (&#8220;what happens in the next
statements?&#8221;) and on explaining code that can be interpreted as
complicated.</p>
</div>
<div class="section" id="refactoring-into-functions">
<span id="index-0"></span><h3>Refactoring into functions<a class="headerlink" href="#refactoring-into-functions" title="Permalink to this headline">¶</a></h3>
<p>At first sight, our updated program seems like
a good starting point for playing around
with the mathematical problem: we can just change parameters and rerun.
Although such edit-and-rerun sessions are good for initial exploration,
one will soon extend the experiments and start developing the code
further. Say we want to compare <span class="math">\(\theta =0,1,0.5\)</span> in the same
plot. This extension requires changes all over the code and quickly
leads to errors. To do something serious with this program, we have to
break it into smaller pieces and make sure each piece is well tested,
and ensure that the program is sufficiently general and can be reused in
new contexts without changes.  The
next natural step is therefore to isolate the numerical computations
and the visualization in separate Python functions.
Such a rewrite of a code, without essentially changing the functionality,
but just improve the quality of the code, is known as <em>refactoring</em>.
After one has quickly put some code down and tested it, it is a common
step to refactor it so it is better prepared for extensions.</p>
</div>
<div class="section" id="program-file-vs-ide-vs-notebook">
<h3>Program file vs IDE vs notebook<a class="headerlink" href="#program-file-vs-ide-vs-notebook" title="Permalink to this headline">¶</a></h3>
<p>There are basically three different ways of working with Python code:</p>
<ol class="arabic simple">
<li>One writes the code in a file, using a text editor (such as
Emacs or Vim) and runs it in a terminal window.</li>
<li>One applies an <em>Integrated Development Environment</em> (the simplest is IDLE, which comes with standard Python) containing a graphical user interface with an editor and an element where Python code can be run.</li>
<li>One applies the Jupyter Notebook (previously known as IPython Notebook),
which offers an interactive environment for Python code where
plots are automatically inserted after the code, see Figure <a class="reference internal" href="#softeng1-ipynb"><span>Experimental code in a notebook</span></a>.</li>
</ol>
<p>It appears that method 1 and 2 are quite equivalent, but the notebook
encourages more experimental code in flat programs. Therefore, notebook
users will normally need to think more about refactoring code and increase
the use of functions.</p>
<div class="figure" id="id1">
<span id="softeng1-ipynb"></span><a class="reference internal image-reference" href="_images/ipynb_flat.png"><img alt="_images/ipynb_flat.png" src="_images/ipynb_flat.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text"><em>Experimental code in a notebook</em></span></p>
</div>
</div>
</div>
<div class="section" id="implementing-the-numerical-algorithm-in-a-function">
<span id="softeng1-basic-func"></span><h2>Implementing the numerical algorithm in a function<a class="headerlink" href="#implementing-the-numerical-algorithm-in-a-function" title="Permalink to this headline">¶</a></h2>
<p>The solution formula <a href="#equation-softeng1:utheta">(3)</a> is completely general and
should be available as a Python function <code class="docutils literal"><span class="pre">solver</span></code> with all input data as
function arguments and all output data returned to the calling code.
With this <code class="docutils literal"><span class="pre">solver</span></code> function we can solve all types of problems
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a>
by an easy-to-read one-line statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Refactoring the numerical method in the previous flat program
in terms of a <code class="docutils literal"><span class="pre">solver</span></code> function leads to this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>               <span class="c"># avoid integer division</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>        <span class="c"># no of time intervals</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Nt</span><span class="o">*</span><span class="n">dt</span>                    <span class="c"># adjust T to fit time step dt</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
        <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
<div class="admonition-tip-always-use-a-doc-string-to-document-a-function admonition">
<p class="first admonition-title">Tip: Always use a doc string to document a function</p>
<p class="last">Python has a convention for documenting the purpose and usage of
a function in a <em>doc string</em>: simply place the documentation
in a one- or multi-line triple-quoted string right after the
function header.</p>
</div>
<div class="admonition-be-careful-with-unintended-integer-division admonition">
<p class="first admonition-title">Be careful with unintended integer division</p>
<p class="last">Note that we in the <code class="docutils literal"><span class="pre">solver</span></code> function explicitly covert <code class="docutils literal"><span class="pre">dt</span></code> to a
<code class="docutils literal"><span class="pre">float</span></code> object. If not, the updating formula for <code class="docutils literal"><span class="pre">u[n+1]</span></code> may evaluate
to zero because of integer division when <code class="docutils literal"><span class="pre">theta</span></code>, <code class="docutils literal"><span class="pre">a</span></code>, and <code class="docutils literal"><span class="pre">dt</span></code> are integers!</p>
</div>
</div>
<div class="section" id="do-not-have-several-versions-of-a-code">
<h2>Do not have several versions of a code<a class="headerlink" href="#do-not-have-several-versions-of-a-code" title="Permalink to this headline">¶</a></h2>
<p>One of the most serious flaws in computational work is to have several
slightly different implementations of the same computational algorithms
lying around in various program files. This is very likely to happen,
because busy scientists often want to test a slight variation of a code to see
what happens. A quick copy-and-edit does the task, but such quick hacks tend
to survive. When a real correction is needed in the implementation,
it is difficult to ensure that the correction is done in all relevant files.
In fact, this is a general problem in programming, which has led to
an important principle.</p>
<div class="admonition-the-dry-principle-don-t-repeat-yourself admonition">
<p class="first admonition-title">The DRY principle: Don&#8217;t repeat yourself</p>
<p class="last">When implementing a particular functionality in a computer program, make sure
this functionality and its variations are implemented in just one piece
of code. That is, if you need to revise the implementation, there should be
<em>one and only one</em> place to edit. It follows that you should never
duplicate code (don&#8217;t repeat yourself!), and code snippets that are
similar should be factored into one piece (function) and parameterized (by
function arguments).</p>
</div>
<p>The DRY principle means that our <code class="docutils literal"><span class="pre">solver</span></code> function should not be
copied to a new file if we need some modifications. Instead, we
should try to extend <code class="docutils literal"><span class="pre">solver</span></code> such that the new and old needs are
met by a single function. Sometimes this process requires a new
refactoring, but having a numerical method in one and only one place
is a great advantage.</p>
</div>
<div class="section" id="making-a-module">
<span id="softeng1-basic-module"></span><h2>Making a module<a class="headerlink" href="#making-a-module" title="Permalink to this headline">¶</a></h2>
<p>As soon as you start making Python functions in a program, you should
make sure the program file fulfills the requirement of a module.
This means that you can import and reuse your functions in other
programs too. For example, if our <code class="docutils literal"><span class="pre">solver</span></code> function resides in a
module file <code class="docutils literal"><span class="pre">decay.py</span></code>, another program may reuse of the
function either by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">solver</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>or by a slightly different import statement, combined with a subsequent
prefix of the function name by the name of the module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">decay</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>The requirements for a program file to also qualify for a module are simple:</p>
<ol class="arabic simple">
<li>The filename without <code class="docutils literal"><span class="pre">.py</span></code> must be a valid Python variable name.</li>
<li>The main program must be executed (through statements or
a function call) in the <em>test block</em>.</li>
</ol>
<p>The <em>test block</em> is normally placed at the end of a module file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Statements</span>
</pre></div>
</div>
<p>When the module file is executed as a stand-alone program, the if test
is true and the indented statements are run. If the module file
is imported, however, <code class="docutils literal"><span class="pre">__name__</span></code> equals the module name and the test block
is not executed.</p>
<p>To demonstrate the difference, consider the trivial module
file <code class="docutils literal"><span class="pre">hello.py</span></code> with one function and a call to this function as main program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>Without the test block, the code reads</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>With this latter version of the file,
any attempt to import <code class="docutils literal"><span class="pre">hello</span></code> will, at the same time,
execute the call <code class="docutils literal"><span class="pre">hello()</span></code> and
hence write &#8220;Hello, World!&#8221; to the screen.
Such output is not desired when importing a module!
To make import and execution of code independent for another
program that wants to use the function <code class="docutils literal"><span class="pre">hello</span></code>, the module <code class="docutils literal"><span class="pre">hello</span></code>
must be written with a test block. Furthermore, running the file itself as
<code class="docutils literal"><span class="pre">python</span> <span class="pre">hello.py</span></code> will make the block active and lead to the desired printing.</p>
<div class="admonition-all-coming-functions-are-placed-in-a-module admonition">
<p class="first admonition-title">All coming functions are placed in a module</p>
<p class="last">The many functions to be explained in the following text are
put in one module file <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/decay.py">decay.py</a>.</p>
</div>
<p>What more than the <code class="docutils literal"><span class="pre">solver</span></code> function is needed in our <code class="docutils literal"><span class="pre">decay</span></code> module
to do everything we did in the previous, flat program?
We need import statements for <code class="docutils literal"><span class="pre">numpy</span></code> and <code class="docutils literal"><span class="pre">matplotlib</span></code> as well as
another function for producing the plot. It can also be convenient
to put the exact solution in a Python function.
Our module <code class="docutils literal"><span class="pre">decay.py</span></code> then looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>           <span class="c"># dashed red line with circles</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
</div>
<p>This module file does exactly the same as the previous, flat program,
but now it becomes much easier to extend the code with more functions
that produce other plots, other experiments, etc. Even more important, though,
is that the numerical
algorithm is coded and tested once and for all in the <code class="docutils literal"><span class="pre">solver</span></code>
function, and any need to solve the mathematical problem is a matter
of one function call.</p>
</div>
<div class="section" id="prefixing-imported-functions-by-the-module-name">
<span id="softeng1-basic-modprefix"></span><h2>Prefixing imported functions by the module name<a class="headerlink" href="#prefixing-imported-functions-by-the-module-name" title="Permalink to this headline">¶</a></h2>
<p id="index-1">Import statements of the form <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> import
<em>all</em> functions and variables in <code class="docutils literal"><span class="pre">module.py</span></code> into the current file.
This is often referred to as &#8220;import star&#8221;, and
many find this convenient, but it is not considered as a good
programming style in Python.
For example, when doing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>we get mathematical functions like <code class="docutils literal"><span class="pre">sin</span></code> and <code class="docutils literal"><span class="pre">exp</span></code>
as well as MATLAB-style functions like <code class="docutils literal"><span class="pre">linspace</span></code> and <code class="docutils literal"><span class="pre">plot</span></code>,
which can be called by these well-known names.
Unfortunately, it sometimes becomes confusing to
know where a particular function comes from, i.e., what modules
you need to import. Is a desired function from <code class="docutils literal"><span class="pre">numpy</span></code> or
<code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code>? Or is it our own function?
These questions are easy to answer if functions in modules are prefixed
by the module name. Doing an additional <code class="docutils literal"><span class="pre">from</span> <span class="pre">math</span> <span class="pre">import</span> <span class="pre">*</span></code> is really
crucial: now <code class="docutils literal"><span class="pre">sin</span></code>, <code class="docutils literal"><span class="pre">cos</span></code>, and other mathematical functions are
imported and their names hide those previously imported from <code class="docutils literal"><span class="pre">numpy</span></code>.
That is, <code class="docutils literal"><span class="pre">sin</span></code> is now a sine function that accepts a <code class="docutils literal"><span class="pre">float</span></code> argument,
not an array.</p>
<p>Doing the import such that module functions must have a prefix
is generally recommended:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>The modules <code class="docutils literal"><span class="pre">numpy</span></code> and <code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code> are frequently used,
and since their full names are quite tedious to write,
two standard abbreviations
have evolved in the Python scientific computing community:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>The downside of prefixing functions by the module name is that
mathematical expressions like <span class="math">\(e^{-at}\sin(2\pi t)\)</span> get
cluttered with module names,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="c"># or</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Such an expression looks like <code class="docutils literal"><span class="pre">exp(-a*t)*sin(2*pi*t)</span></code> in most
other programming languages. Similarly,
<code class="docutils literal"><span class="pre">np.linspace</span></code> and <code class="docutils literal"><span class="pre">plt.plot</span></code> look less familiar to people who are
used to MATLAB and who have not adopted Python&#8217;s prefix style.
Whether to do <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> or <code class="docutils literal"><span class="pre">import</span> <span class="pre">module</span></code> depends
on personal taste and the problem at hand. In these writings we use
<code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span></code> in more basic, shorter programs where similarity with
MATLAB could be an advantage. Prefix of mathematical
functions in formulas is something we often avoid to obtain
a one-to-one correspondence between
mathematical formulas and the Python code.</p>
<p>Our <code class="docutils literal"><span class="pre">decay</span></code> module can be edited to use the module prefix for
<code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code> and <code class="docutils literal"><span class="pre">numpy</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># dashed red line with circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for u_e</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
</div>
<p>Without the prefix, the import and mathematical formulas read</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="example-on-extending-the-module-code">
<span id="softeng1-basic-experiment2"></span><h2>Example on extending the module code<a class="headerlink" href="#example-on-extending-the-module-code" title="Permalink to this headline">¶</a></h2>
<p>Let us specifically demonstrate one extension of the
flat program in the section <a class="reference internal" href="#softeng1-basic-impl1"><span>A first, quick implementation</span></a>
that would require substantial editing of the flat code
(the section <a class="reference internal" href="#softeng1-basic-impl2"><span>A more decent program</span></a>), while
in a structured module
(the section <a class="reference internal" href="#softeng1-basic-module"><span>Making a module</span></a>), we can simply add a new function without
affecting the existing code.</p>
<p>Our example that illustrates the extension
is to make a comparison between the numerical solutions
for various schemes (<span class="math">\(\theta\)</span> values) and the exact solution:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/compare.png"><img alt="_images/compare.png" src="_images/compare.png" style="width: 600px;" /></a>
</div>
<div class="admonition-wait-a-minute admonition">
<p class="first admonition-title">Wait a minute</p>
<p class="last">Look at the flat program in
the section <a class="reference internal" href="#softeng1-basic-impl1"><span>A first, quick implementation</span></a>,
and try to imagine which edits that are required to solve this new problem.</p>
</div>
<p>With the <code class="docutils literal"><span class="pre">solver</span></code> function at hand, we can simply create a function
with a loop over <code class="docutils literal"><span class="pre">theta</span></code> values and add the necessary plot statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_schemes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Compare theta=0,1,0.5 in the same plot.&quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;--o&#39;</span><span class="p">)</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>        <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A call to this <code class="docutils literal"><span class="pre">experiment_compare_schemes</span></code> function must be placed
in the test block, or you can run the program from IPython instead:</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">experiment_compare_schemes</span><span class="p">()</span>
</pre></div>
</div>
<p>We do not present how the flat program from
the section <a class="reference internal" href="#softeng1-basic-impl2"><span>A more decent program</span></a> must be refactored to produce the
desired plots, but simply state that the danger of introducing bugs
is significantly larger than when just writing an additional function
in the <code class="docutils literal"><span class="pre">decay</span></code> module.</p>
</div>
<div class="section" id="documenting-functions-and-modules">
<span id="softeng1-basic-docstring"></span><h2>Documenting functions and modules<a class="headerlink" href="#documenting-functions-and-modules" title="Permalink to this headline">¶</a></h2>
<p>We have already emphasized the importance of documenting functions with
a doc string (see the section <a class="reference internal" href="#softeng1-basic-func"><span>Implementing the numerical algorithm in a function</span></a>). Now it is time
to show how doc strings should be structured in order to take advantage
of the documentation utilities in the <code class="docutils literal"><span class="pre">numpy</span></code> module. The idea is
to follow a convention that in itself makes a good pure text doc string
in the terminal window
and at the same time can be translated to beautiful HTML manuals for
the web.</p>
<p>The conventions for <code class="docutils literal"><span class="pre">numpy</span></code> style doc strings are well
<a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">documented</a>, so here we just present a basic example that the reader can adopt.
Input arguments to a function are listed under the heading <code class="docutils literal"><span class="pre">Parameters</span></code>,
while returned values are listed under <code class="docutils literal"><span class="pre">Returns</span></code>. It is a good idea to
also add an <code class="docutils literal"><span class="pre">Examples</span></code> section on the usage of the function.
More complicated software may have additional sections, see <code class="docutils literal"><span class="pre">pydoc</span> <span class="pre">numpy.load</span></code>
for an example. The markup language available for doc strings is
Sphinx-extended reStructuredText. The example below shows typical
constructs: 1) how inline
mathematics is written with the <code class="docutils literal"><span class="pre">:math:</span></code> directive, 2) how arguments
to the functions are referred to using single backticks
(inline monospace font for code applies double backticks), and 3) how
arguments and return values are listed with types and explanation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve  \( u&#39;=-au \)  with  \( u(0)=I \)  for  \( t \in (0,T] \) </span>
<span class="sd">    with steps of `dt` and the method implied by `theta`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I: float</span>
<span class="sd">        Initial condition.</span>
<span class="sd">    a: float</span>
<span class="sd">        Parameter in the differential equation.</span>
<span class="sd">    T: float</span>
<span class="sd">        Total simulation time.</span>
<span class="sd">    theta: float, int</span>
<span class="sd">        Parameter in the numerical scheme. 0 gives</span>
<span class="sd">        Forward Euler, 1 Backward Euler, and 0.5</span>
<span class="sd">        the centered Crank-Nicolson scheme.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `u`: array</span>
<span class="sd">        Solution array.</span>
<span class="sd">    `t`: array</span>
<span class="sd">        Array with time points corresponding to `u`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Solve  \( u&#39; = -\\frac{1}{2}u, u(0)=1.5 \) </span>
<span class="sd">    with the Crank-Nicolson method:</span>

<span class="sd">    &gt;&gt;&gt; u, t = solver(I=1.5, a=0.5, T=9, theta=0.5)</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(t, u)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>If you follow such doc string conventions in your software, you can
easily produce nice manuals that meet the standard expected within
the Python scientific computing community.</p>
<p><a class="reference external" href="http://sphinx-doc.org/">Sphinx</a> requires quite a number of manual steps to
prepare a manual, so it is
recommended to use a <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/make_sphinx_api.py">premade script</a> to automate the steps.
(You need to do a <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code> of <code class="docutils literal"><span class="pre">sphinx</span></code> and <code class="docutils literal"><span class="pre">numpydoc</span></code> to make the
script work.)
Figure <a class="reference internal" href="#softeng1-basic-docstring-fig"><span>Example on Sphinx API manual in HTML</span></a> provides an example of what
the above doc strings look like when Sphinx has transformed them to HTML.</p>
<div class="figure" id="id2">
<span id="softeng1-basic-docstring-fig"></span><a class="reference internal image-reference" href="_images/selfdoc_numpy.png"><img alt="_images/selfdoc_numpy.png" src="_images/selfdoc_numpy.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text"><em>Example on Sphinx API manual in HTML</em></span></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <center>
            <p class="logo"><a href="http://cbc.simula.no/" title="Go to Center for Biomedical Computing">
              <img class="logo" src="_static/cbc_logo.png" alt="Logo"/>
            </a></p>
            </center>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic implementations</a><ul>
<li><a class="reference internal" href="#mathematical-problem-and-solution-technique">Mathematical problem and solution technique</a></li>
<li><a class="reference internal" href="#a-first-quick-implementation">A first, quick implementation</a></li>
<li><a class="reference internal" href="#a-more-decent-program">A more decent program</a><ul>
<li><a class="reference internal" href="#comments">Comments</a></li>
<li><a class="reference internal" href="#refactoring-into-functions">Refactoring into functions</a></li>
<li><a class="reference internal" href="#program-file-vs-ide-vs-notebook">Program file vs IDE vs notebook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-the-numerical-algorithm-in-a-function">Implementing the numerical algorithm in a function</a></li>
<li><a class="reference internal" href="#do-not-have-several-versions-of-a-code">Do not have several versions of a code</a></li>
<li><a class="reference internal" href="#making-a-module">Making a module</a></li>
<li><a class="reference internal" href="#prefixing-imported-functions-by-the-module-name">Prefixing imported functions by the module name</a></li>
<li><a class="reference internal" href="#example-on-extending-the-module-code">Example on extending the module code</a></li>
<li><a class="reference internal" href="#documenting-functions-and-modules">Documenting functions and modules</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="._main_softeng1001.html"
                        title="previous chapter">&lt;no title&gt;</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="._main_softeng1003.html"
                        title="next chapter">User interfaces</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/._main_softeng1002.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="._main_softeng1003.html" title="User interfaces"
             >next</a> |</li>
        <li class="right" >
          <a href="._main_softeng1001.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li><a href="index.html">Scientific software engineering; ODE model</a> &raquo;</li> 
      </ul>
    </div>
<div class="wrapper">
  <div class="footer">
  <a href="http://cbc.simula.no"><img src="_static/cbc_banner.png" width="100%"><a>
  </div>
</div>

  </body>
</html>